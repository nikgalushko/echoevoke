**Как переиграть самого себя**

 Под моим крылом есть один сервис, своего рода умный прокси. Он отлично
 себе работал в k8s, много подов, просто ноль проблем. Мы решили
 перенести его на baremetal. Сказано — сделано. Когда я начал
 переносить его, обнаружил, что сервис не справляется с нагрузкой, хотя
 железо там приличное. Сначала решил снять профиль. Просмотрев его,
 заметил, что большую часть времени процессор занят syscall-ами, так
 что оптимизация кода вокруг не имела бы большого смысла.


 Начал думать что да как. И тут я вспомнил о прекрасном syscall в Linux
 --
 `sendfile`
 , который позволяет быстро копировать данные между файловым
 дескриптором и сокетом, работая строго в пространстве ядра.


 Немного общения с ChatGPT навело меня на
 `splice/vmsplice`
 . Эврика! В Go точно должна быть подобная обвязка, подумал я.
 Несколько минут исследований подтвердили мои догадки — такая обвязка
 существует и называется
 `io.Copy`
 !


 Смех в том, что я специально
 `io.Copy`
 не использовал в своем коде, думал сейчас намучу тут всякие
 `sync.Pool`
 , буду проксировать http тело чанками так, чтобы в страницу памяти
 укладывалось и всякое такое. После того, как выкинул все эти заумности
 и переписал на простой
 `io.Copy`
 , то и код стал короче и работает намного быстрее.


 P.S. Как сказал один мудрый человек: "Преждевременная оптимизация
 — корень всех зол".